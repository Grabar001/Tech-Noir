{% extends 'base.html.twig' %}

{% block title %}
	{{ categorie.nom }}
	| Catalogue
{% endblock %}

{% block body %}
	<div class="catalog-page">

		<nav class="breadcrumb">
			<a href="{{ path('homepage') }}">Accueil</a>
			/
			<span>{{ categorie.nom }}</span>
		</nav>

		<div class="catalog-container">
			<aside class="filters">

				<form method="get">
					{% if filtres is not empty %}
						{% for filtre in filtres %}
							<div class="filter-block">
								<h4>{{ filtre.nom }}</h4>

								{% for valeur in filtre.filtreValeurs %}
									<div class="filter-option">
										<input type="checkbox" name="filter_{{ filtre.id }}[]" value="{{ valeur.valeur }}" id="filtre_{{ filtre.id }}_{{ loop.index }}" {% if valeur.valeur in app.request.get('filter_' ~ filtre.id)|default([]) %} checked {% endif %}>
										<label for="filtre_{{ filtre.id }}_{{ loop.index }}">{{ valeur.valeur }}</label>
									</div>
								{% endfor %}
							</div>
						{% endfor %}
						<button type="submit">Filtrer</button>
					{% else %}
						<p>Aucun filtre disponible pour cette catégorie.</p>
					{% endif %}
				</form>

			</aside>

			<main class="catalog-products">
				<h2>{{ categorie.nom }}</h2>
				<div class="products-grid">
					{% for produit in produits %}
						<div class="product-card">
							{% if produit.reduction %}
								<div class="discount">-{{ produit.reduction }}%</div>
							{% endif %}
							{% if produit.isNew %}
								<div class="badge">NEW</div>
							{% endif %}

							<img src="{{ asset(produit.image) }}" alt="{{ produit.nom }}">
							<h4>{{ produit.nom }}</h4>

							{% if produit.reduction %}
								<p class="old-price">
									{{ (produit.prix * 100) / (100 - produit.reduction) | round(2) }}
									€
								</p>
							{% endif %}

							<p class="new-price">{{ produit.prix }}
								€</p>

							<p class="stock">
								{% if produit.enStock %}✅ En stock{% else %}❌ Rupture
								{% endif %}
							</p>

							<button>Ajouter au panier</button>
						</div>
					{% else %}
						<p>Aucun produit dans cette catégorie.</p>
					{% endfor %}
				</div>
			</main>
		</div>
	</div>
{% endblock %}
