{% extends 'base.html.twig' %}

{% block title %}
	{{ categorie.nom }}
	| Catalogue
{% endblock %}

{% block stylesheets %}
    {{ parent() }}
    {{ encore_entry_link_tags('catalog') }}
{% endblock %}

{% block javascripts %}
    {{ parent() }}
    {{ encore_entry_script_tags('catalog') }}
{% endblock %}

{% block body %}
	<div class="catalog-page">

		<nav class="breadcrumb">
			<a href="{{ path('homepage') }}">Accueil</a>
			/
			<span>{{ categorie.nom }}</span>
		</nav>

		<div
			class="catalog-layout">
			{# ░░░░░░░░░░░░░░░░░░░░░░░░░░░░░ LEFT FILTER PANEL ░░░░░░░░░░░░░░░░░░░░░░░░░░░░░ #}
			<aside class="filter-panel">
				<form method="get">
					<h3>Filtres</h3>
					{% for filtre in filtres %}
						<div class="filter-group">
							<h4>{{ filtre.nom }}</h4>
							{% for valeur in filtre.filtreValeurs %}
								<label class="filter-option">
									<input type="checkbox" name="filter_{{ filtre.id }}[]" value="{{ valeur.valeur }}" id="valeur_{{ valeur.id }}" {% if valeur.valeur in app.request.get('filter_' ~ filtre.id)|default([]) %} checked {% endif %}>
									{{ valeur.valeur }}
								</label>
							{% endfor %}
						</div>
					{% endfor %}
					<button type="submit" class="btn-filter">Filtrer</button>
				</form>
			</aside>

			{# ░░░░░░░░░░░░░░░░░░░░░░░░░░░░░ RIGHT PRODUCT PANEL ░░░░░░░░░░░░░░░░░░░░░░░░░░░░░ #}
			<main class="product-panel">
				<div class="top-bar">
					<h2>{{ categorie.nom }}</h2>
					<div class="view-toggle">
						<a href="#" class="toggle-btn grid">▦</a>
						<a href="#" class="toggle-btn list">☰</a>
					</div>
				</div>

				<div class="products products-grid" id="product-container">
					
					{% for produit in produits %}
						<div class="product-card">
							{% if produit.reduction %}
								<div class="badge discount">-{{ produit.reduction }}%</div>
							{% endif %}
							{% if produit.isNew %}
								<div class="badge new">NEW</div>
							{% endif %}

							<img src="{{ asset('images/uploads/produits/' ~ produit.image) }}" alt="{{ produit.nom }}">

							<div class="product-info">
								<h4>{{ produit.nom }}</h4>

								{% if produit.reduction %}
									<p class="old-price">{{ (produit.prix * 100) / (100 - produit.reduction) | round(2) }}
										€</p>
								{% endif %}

								<p class="new-price">{{ produit.prix }}
									€</p>
								<p class="stock">
									{% if produit.enStock %}✅ En stock{% else %}❌ Rupture
									{% endif %}
								</p>
							</div>

							<form action="{{ path('cart_add', {'id': produit.id}) }}" method="post">
								<button type="submit" class="btn-add">Ajouter au panier</button>
							</form>
						</div>
					{% else %}
						<p class="no-products">Aucun produit trouvé.</p>
					{% endfor %}
				</div>
			</main>
		</div>
	</div>
{% endblock %}
